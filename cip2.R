## Calculates cumulative invasion pressure using dplyr functions
## Reads in data from .csv as a data frame and then chains dplyr functions using %>% operator to return total number of "species-years" for each HUC12
## HUC12 ID's are preceded by "x" in the .csv to prevent corruption when importing
## Default path is to file in working directory, function can take an alternative path as input



## The code (package dplyr must be installed)

cumulative_invasion_pressure <- function(file = "Plants_DB.csv") {
  plantsDB<-tbl_df(read.csv(file, header = TRUE))
  return(CIP <- select(plantsDB, xHUC12, sciName, year) %>% group_by(xHUC12, sciName) %>% summarize(year=min(year)) %>% mutate(time = 2016-year) %>% group_by(xHUC12) %>% summarize(cip = sum(time)) %>% arrange(cip))
}



## Explanation of code

## Imports .csv as a data frame
# plantsDB<-tbl_df(read.csv(file, header = TRUE))

## Selects only the necessary columns from the data frame
# select(plantsDB, xHUC12, sciName, year)

## Groups the remaining columns by HUC12 and then species name
# %>% group_by(xHUC12, sciName)

## Returns the earliest year for each species in each HUC12
# %>% summarize(year=min(year))

## Generates a new column variable "time" that incidates the time since invasion (2016-earliest year) for each species in each HUC12
# %>% mutate(time = 2016-year)

## Groups all data by HUC12 (note: it's possible that this step may be unecessary)
# %>% group_by(xHUC12) 

## Returns the sum of all times-since-invasion in each HUC12; this is the cumulative invasion pressure, in total "species-years"
# %>% summarize(cip = sum(time))

## Cleans up the output by sorting by CIP (this step is optional)
# %>% arrange(cip)




## Example runs

# CIP <- cumulative_invasion_pressure()  ## if data is saved as Plants_DB.csv in working directory

# CIP <- cumulative_invasion_pressure("D://Aquatic_Rdata/Plants_DB_conus_hucs_dated_LL.csv")  ## for alternative path to data

# tail(CIP)

## A tibble: 6 × 2
#         xHUC12   cip
#         <fctr> <dbl>
#1 x010700050203  1906
#2 x011000040301  2034
#3 x180201580401  2194
#4 x180701050208  2208
#5 x020700100103  3056
#6 x010900010704  3072




